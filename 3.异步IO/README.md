# 第三章异步I/O
## 为什么要异步I/O
### 用户体验
异步的概念之所以火起来，是因为在浏览器中JavaScript在单线程上执行，而且它还与UI渲染公用一个线程。

如果不使用异步,而采用同步代码的话
```
// 消费时间为M
getData('form_db');
// 消费时间为N
getData('form_remote_api');
```
消耗时间为M+N
```

getData('form_db', function() {
    // 消费时间为M  
});
getData('form_remote_api', function() {
    // 消费时间为N
});
```
消耗时间为Max(M, N),因为JS脚本执行变快，异步I/O会大大提升用户的体验
### 资源分配
如果业务场景中有一组互不相关的任务需要完成，现行的主流方式有2种
1. 单线程串行依次执行
2. 多线程并行完成

如果创建多线程的开销小于并行执行，那么多线程的方式是首选的。多线程的代价在于创建线程和执行期线程上下文切换的开销较大。另外，在复杂的业务中，多线程编程经常面临锁、状态同步等问题，这是多线程被诟病的主要原因。但是多线程在多核CPU上能够有效提升CPU的利用率，这个优势是毋庸置疑的。

单线程顺序执行任务的方式比较符合编程人员按顺序思考的思维方式。它依然是最主流的编程方式，因为它易于表达。但是串行执行的缺点在于性能，任意一个略慢的任务都会导致后续执行代码被阻塞。在计算机资源中，通常I/O的进行会让后续任务等待，这造成资源不能被很好地利用。

操作系统会将CPU的时间片分配给其余进程，以公平而有效地利用资源，基于这一点，有的服务器为了提升响应能力，会通过启动多个工作进程来为更多的用户服务。但是对于这一组任务而言，他无法分发任务到多个进程上，所以依然无法高效利用资源，结束所有任务所需的时间会较长。这种模式类似于加三倍服务器。

单线程同步编程模型会因阻塞I/O导致硬件资源得不到更优的使用。多线程编程模型也因为编程中的死锁、状态同步等问题让开发人员头疼。

Node在两者之间给出了它的方案：利用单线程，远离多线程死锁、状态同步等问题；利用异步I/O，让单线程远离阻塞，以更好地使用CPU。

异步I/O的提出是期望I/O的调用不再阻塞后续运算，将原有等待I/O完成的这段时间分配给其余需要的业务执行。
## 异步I/O是实现现状
